<library>
    <section>
        <name>FEPs</name>
        <subsection>
            <name>cuts</name>
            <pattern>
                <name>cut-in</name>
                <comment>object relation is missing</comment>
                <code><![CDATA[
match [
{actors = a1, scale = head_s},
{scale < head_s}+,
{actors = a2}]
from shots
where len(intersection(a1.id, a2.id)) >= 1
                ]]></code>
            </pattern>
            <pattern>
                <name>cut-away to people</name>
                <code><![CDATA[
match [
{actors = a1},
{actors = a2},
{actors = a3}]
from shots
where len(intersection(a1.id, a3.id)) >= 1 and len(intersection(a1.id, a2.id)) == 0 and len(a2) >= 2
                ]]></code>
            </pattern>
            <pattern>
                <name>cut-away to objects</name>
                <code><![CDATA[
match [
{actors = a1},
{faces = []}+,
{actors = a2}]
from shots
where len(intersection(a1.id, a2.id)) >= 1
                ]]></code>
            </pattern>
        </subsection>
        <subsection>
            <name>intensification</name>
            <pattern>
                <name>same face</name>
                <code><![CDATA[
match [
{actors = a1s},
{actors = a2s}]
from shots
where any(lambda pair: match pair:
    case Rule actor_id [a1, a2]:
      a2.size / a1.size > 1.05
    case _:
      False
  , groupBy(lambda a: a.id, a1s + a2s))
                ]]></code>
            </pattern>
            <pattern>
                <name>multiple faces</name>
                <code><![CDATA[
def smedian(x):
  match median(for xx in x: if xx < 0.1: xx):
    case Just y: y
    case Nothing: 0.

match [{faces = a1}, {faces = a2}, {faces = a3}]
from shots
where (
    smedian(a2.size) / smedian(a1.size) > 1.05 and
    smedian(a3.size) / smedian(a2.size) > 1.05 and
    len(a1) >= 2 and len(a2) >= 2
)
                ]]></code>
            </pattern>
            <pattern>
                <name>object</name>
                <code><![CDATA[
                    # missing object relation
                ]]></code>
            </pattern>
        </subsection>
        <subsection>
            <name>shot/reverse shot</name>
            <pattern>
                <code><![CDATA[
match [
{faces = [{id = a, gaze = g1}]},
{faces = [{id = b, gaze = g2}]},
{faces = [{id = a, gaze = g3}]}
] from shots where a != b and all(lambda g: abs(g.h) > 2.5, [g1, g2, g3])
                ]]></code>
            </pattern>
        </subsection>
        <subsection>
            <name>POV</name>            
            <pattern>
                <code><![CDATA[
match [
{faces = f1, scale < MEDIUM_SHOT},
{faces = f2},
{faces = f3, scale < MEDIUM_SHOT}]
from shots
where actor_relation(f1, f3) == SAME and actor_relation(f1, f2) == DIFFERENT
                ]]></code>
            </pattern>
        </subsection>
        <subsection>
            <name>region</name>
            <pattern>
                <name>frameshare</name>
                <code><![CDATA[
match [
{faces = [{id = a, region = ra, actor = True}]},
{faces = [{id = b, region = rb, actor = True}]}
] from shots
where a != b and region_relation(ra, rb) == SAME
                ]]></code>
            </pattern>
            <pattern>
                <name>opposition</name>
                <code><![CDATA[
match [
{faces = [{id = a, region = ra, actor = True}]},
{faces = [{id = b, region = rb, actor = True}]}
] from shots
where a != b and region_relation(ra, rb) == DIFFERENT
                ]]></code>
            </pattern>
        </subsection>
        <subsection>
            <name>enhancement</name>

            <pattern>
                <name>thematics enhancement</name>
                <comment>Hannover Technical Feature A, Unknown Thresholds</comment>
                <code><![CDATA[
match [s1, s2, {}]
from shots
where s1.next.action.kineticsvmae > 0.95 and s2.next.action.kineticsvmae > 0.95
                ]]></code>
            </pattern>
            <pattern>
                <name>thematics enhancement</name>
                <comment>Hannover Technical Feature B, Unknown Thresholds</comment>
                <code><![CDATA[
match [s1, s2, {}]
from shots
where s1.next.action.ssv2vmae > 0.95 and s2.next.action.ssv2vmae > 0.95
                ]]></code>
            </pattern>
            <pattern>
                <name>thematics enhancement</name>
                <comment>Hannover Technical Feature C, Unknown Thresholds</comment>
                <code><![CDATA[
match [s1, s2, {}]
from shots
where s1.next.action.kineticsxclip > 0.95 and s2.next.action.kineticsxclip > 0.95
                ]]></code>
            </pattern>

            <pattern>
                <name>ambience enhancement</name>
                <comment>Hannover Technical Feature A, Unknown Thresholds</comment>
                <code><![CDATA[
match [s1, s2, {}]
from shots
where s1.next.audio.wav2vec2 > 0.95 and s2.next.audio.wav2vec2 > 0.95
                ]]></code>
            </pattern>
            <pattern>
                <name>ambience enhancement</name>
                <comment>Hannover Technical Feature B, Unknown Thresholds</comment>
                <code><![CDATA[
match [s1, s2, {}]
from shots
where s1.next.audio.beats > 0.95 and s2.next.audio.beats > 0.95
                ]]></code>
            </pattern>
            <pattern>
                <name>ambience enhancement</name>
                <comment>Hannover Technical Feature C, Unknown Thresholds</comment>
                <code><![CDATA[
match [s1, s2, {}]
from shots
where s1.next.audio.whisper > 0.95 and s2.next.audio.whisper > 0.95
                ]]></code>
            </pattern>

        </subsection>
    </section>
    <section>
        <name>Strategies</name>
        <subsection>
            <name>individualisation</name>
                <pattern>
                    <code><![CDATA[
match [
{faces = [{id = a}], scale <= MEDIUM_SHOT, st = st1},
{faces = [{id = a}], scale <= MEDIUM_SHOT}
] from shots join speakerTurns as st
where max(st1.words.propn) > 0
                    ]]></code>
                </pattern>
        </subsection>
        <subsection>
            <name>emotionalisation</name>
            <pattern>
                <name>based on face emotion</name>
                <code><![CDATA[
match [
{faces=[{emotion={top=a}}]},
{faces=[{emotion={top=a}}]}
] from shots where a != "unknown" and a != "neutral"
                ]]></code>
            </pattern>
            <pattern>
                <name>based on speaker emotion</name>
                <code><![CDATA[
match [
{emotion={top=a}},
{emotion={top=a}}
] from speakerTurns where a != "unknown" and a != "neutral"
                ]]></code>
            </pattern>
        </subsection>
    </section>
    <section>
        <name>Explore</name>
    </section>
    <section>
        <name>Tutorial</name>
    </section>
</library>
